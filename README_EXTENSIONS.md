# DS-VLAB 扩展功能说明

## 概述

本文档介绍 DS-VLAB 平台的扩展功能，包括新增元件、界面优化、文字标注和 AI 桥接层。

---

## 一、新增和扩展的元件

### 1.1 74LS181_8bit（8 位 ALU）

**功能**: 8 位算术逻辑单元，支持多种算术和逻辑运算

**引脚说明**:
- A0-A7: 8 位输入操作数 A
- B0-B7: 8 位输入操作数 B
- S0-S3: 功能选择输入
- M: 模式选择（0=算术，1=逻辑）
- Cn: 进位输入
- F0-F7: 8 位功能输出
- Cn+8: 进位输出
- A=B: 相等输出
- P, G: 传播和生成输出

**使用方法**:
1. 从工具箱"基本数字功能器件"中拖出 `74LS181_8bit`
2. 连接输入引脚 A0-A7 和 B0-B7
3. 设置功能选择 S0-S3 和模式 M
4. 连接进位输入 Cn
5. 从 F0-F7 读取运算结果

### 1.2 74LS163_8bit（8 位同步计数器）

**功能**: 8 位同步二进制计数器，支持清零、并行加载和计数

**引脚说明**:
- -CR: 清零输入（低电平有效）
- CP: 时钟输入
- A-D, E-H: 8 位并行数据输入
- -LD: 加载使能（低电平有效）
- ENP, ENT: 计数使能
- QA-QH: 8 位计数输出
- RCO: 进位输出

**使用方法**:
1. 从工具箱拖出 `74LS163_8bit`
2. 连接时钟信号到 CP
3. 连接数据输入 A-H（用于并行加载）
4. 设置 ENP 和 ENT 为高电平以使能计数
5. 从 QA-QH 读取计数值

**工作模式**:
- **清零模式**: -CR = 0，时钟上升沿时清零
- **加载模式**: -CR = 1, -LD = 0，时钟上升沿加载数据
- **计数模式**: -CR = 1, -LD = 1, ENP = 1, ENT = 1，时钟上升沿计数

### 1.3 74LS191_8bit（8 位可逆计数器）

**功能**: 8 位可逆同步计数器，支持上数/下数、并行加载

**引脚说明**:
- D/U: 方向控制（0=上数，1=下数）
- CP: 时钟输入
- -LOAD: 加载使能（低电平有效）
- A-D, E-H: 8 位并行数据输入
- CTEN: 计数使能（低电平有效）
- QA-QH: 8 位计数输出
- MAX/MIN: 最大/最小值标志
- RCO: 进位输出

**使用方法**:
1. 从工具箱拖出 `74LS191_8bit`
2. 连接时钟信号到 CP
3. 设置 D/U 控制计数方向（0=向上，1=向下）
4. CTEN 设为低电平以使能计数
5. 从 QA-QH 读取计数值

**特点**:
- 可动态改变计数方向
- 到达最大值（255）或最小值（0）时 MAX/MIN 输出高电平
- 支持并行加载初始值

---

## 二、界面优化

### 2.1 连线颜色改进

**改进**: 将默认连线颜色从黄色改为深天蓝色 (#00BFFF)

**原因**:
- 黄色在白色背景上对比度较低
- 深天蓝色更易于识别
- 保持与其他界面元素的视觉协调

**自定义**: 可通过菜单"设置 → 连线颜色设置"更改颜色

### 2.2 清空电路确认

**功能**: 点击"新建"或"文件 → 新建"时，如果电路不为空，会弹出确认对话框

**好处**: 防止误操作导致未保存的电路丢失

---

## 三、文字标注功能

### 3.1 添加文字标注

1. 从工具箱"注释工具"分类中拖出 `TextLabel`
2. 将其放置在电路图的任意位置
3. 双击文字标注打开编辑对话框
4. 输入文本内容，点击确定

### 3.2 编辑文字标注

- **编辑内容**: 双击文字标注
- **移动位置**: 拖动文字标注框
- **删除标注**: 右键点击，选择删除

### 3.3 文字标注的用途

- 标记电路的不同功能区域
- 说明特定元件的用途
- 添加实验步骤说明
- 为演示添加解释性文字

### 3.4 保存和加载

文字标注会随电路一起保存和加载，保持原有位置和内容。

---

## 四、AI 桥接层（Circuit-DSL）

### 4.1 什么是 Circuit-DSL？

Circuit-DSL 是一种领域特定语言（Domain-Specific Language），用于描述数字电路。它允许：
- AI 直接生成可执行的电路
- 用文本描述电路结构
- 快速创建复杂电路
- 分享和重用电路设计

### 4.2 使用 AI 桥接层

#### 方法 1: 导入 DSL 代码

1. 点击菜单 **"AI桥接 → DSL导入"**
2. 在弹出的输入框中输入或粘贴 DSL 代码
3. 点击确定，电路自动生成

#### 方法 2: 使用示例电路

1. 点击菜单 **"AI桥接 → 示例电路"**
2. 选择一个示例（如 `simple_counter`）
3. 查看示例代码
4. 点击确认导入到当前电路

#### 方法 3: 导出为 DSL

1. 在 DS-VLAB 中搭建电路
2. 点击菜单 **"AI桥接 → DSL导出"**
3. 复制生成的 DSL 代码
4. 可以分享给他人或供 AI 学习

### 4.3 Circuit-DSL 语法

#### 基本结构

```dsl
circuit CircuitName {
    components {
        // 元件定义
    }

    connections {
        // 连线定义
    }

    configuration {
        // 配置项
    }
}
```

#### 元件定义语法

```dsl
元件ID: 元件类型 at (X坐标, Y坐标) [with 属性]
```

**示例**:
```dsl
alu1: 74LS181_8bit at (100, 200)
sw1: Switch at (50, 150)
label1: TextLabel at (200, 50) with text="这是标题"
```

#### 连线语法

```dsl
源元件.引脚名 -> 目标元件.引脚名
```

**示例**:
```dsl
sw1.pin0 -> alu1.A0
alu1.F0 -> led1.pin0
counter.QA -> alu.B0
```

#### 配置语法

```dsl
configuration {
    linecolor: "颜色值"
}
```

### 4.4 完整示例

#### 示例 1: 简单开关-LED 电路

```dsl
circuit SimpleLED {
    components {
        sw1: Switch at (100, 100)
        led1: Led at (300, 100)
        label: TextLabel at (150, 50) with text="开关控制LED"
    }

    connections {
        sw1.pin0 -> led1.pin0
    }

    configuration {
        linecolor: "#00BFFF"
    }
}
```

#### 示例 2: 8 位计数器

```dsl
circuit Counter8Bit {
    components {
        counter: 74LS163_8bit at (250, 150)
        clock: ContinuousPulse at (100, 180)
        led0: Led at (450, 120)
        led1: Led at (450, 150)
        led2: Led at (450, 180)
        led3: Led at (450, 210)
        label: TextLabel at (200, 80) with text="8位计数器演示"
    }

    connections {
        clock.pin0 -> counter.CP
        counter.QA -> led0.pin0
        counter.QB -> led1.pin0
        counter.QC -> led2.pin0
        counter.QD -> led3.pin0
    }

    configuration {
        linecolor: "#00FF00"
    }
}
```

#### 示例 3: 可逆计数器

```dsl
circuit ReversibleCounter {
    components {
        counter: 74LS191_8bit at (300, 200)
        clock: ContinuousPulse at (100, 200)
        dir_switch: Switch at (100, 250)
        led_output: Led at (500, 200)
        label_main: TextLabel at (250, 100) with text="可逆计数器"
        label_dir: TextLabel at (50, 250) with text="方向"
    }

    connections {
        clock.pin0 -> counter.CP
        dir_switch.pin0 -> counter.D/U
        counter.QA -> led_output.pin0
    }

    configuration {
        linecolor: "#FF6347"
    }
}
```

### 4.5 支持的元件类型

以下元件类型可在 DSL 中使用：

**基本数字功能器件**:
- `74LS181`, `74LS181_8bit` - ALU
- `74LS163`, `74LS163_8bit` - 计数器
- `74LS191_8bit` - 可逆计数器
- `74LS245` - 总线收发器
- `74LS175`, `74LS174` - D 触发器
- `74LS273` - 8 位寄存器
- `74LS139` - 译码器
- `74LS374` - 八 D 锁存器
- `RAM6116` - 静态 RAM

**逻辑门电路**:
- `ANDgate` - 与门
- `ORgate` - 或门
- `NOTgate` - 非门
- `NANDgate` - 与非门
- `XORgate` - 异或门
- `Triplegate` - 三态门

**基本元件**:
- `Switch` - 开关
- `Led` - LED
- `SinglePulse` - 单脉冲
- `ContinuousPulse` - 连续脉冲

**存储器件**:
- `EPROM2716C3`, `EPROM2716C4` - EPROM
- `SequeTimer` - 时序发生器
- `BUS` - 总线

**注释工具**:
- `TextLabel` - 文字标注

### 4.6 引脚命名规则

1. **使用引脚名称**（推荐）: 如 `A0`, `QA`, `CP`, `-CR`
2. **使用引脚编号**: 如 `pin0`, `pin5`, `pin12`

不同元件的引脚名称参考元件手册或双击元件查看引脚编号。

### 4.7 注意事项

1. **坐标单位**: 像素（px），原点在左上角
2. **引脚名称**: 区分大小写，使用元件定义的实际引脚名
3. **注释**: 使用 `//` 或 `#` 开头的行作为注释
4. **字符串**: 使用双引号包裹文本内容
5. **连线顺序**: 输出引脚 -> 输入引脚

---

## 五、常见问题

### Q1: 如何选择合适的计数器？

- **74LS163_8bit**: 只能向上计数，适合简单的计数应用
- **74LS191_8bit**: 可向上或向下计数，适合需要可逆计数的场合

### Q2: 8 位元件比 4 位元件有什么优势？

- 处理更大的数值范围（0-255 vs 0-15）
- 减少级联的复杂度
- 更接近实际计算机系统的数据宽度

### Q3: Circuit-DSL 能描述所有电路吗？

目前版本支持基本的元件放置和连线。复杂的配置（如 EPROM 内容）暂不支持，需要在导入后手动设置。

### Q4: 如何与 AI 配合使用？

向 AI 描述你需要的电路，AI 会生成对应的 DSL 代码，然后：
1. 复制 AI 生成的 DSL 代码
2. 在 DS-VLAB 中选择"AI桥接 → DSL导入"
3. 粘贴代码并确认
4. 电路自动生成

### Q5: 文字标注会影响电路仿真吗？

不会。文字标注纯粹是视觉元素，不参与电路的电气连接和仿真计算。

---

## 六、技术支持

如有问题或建议，请联系项目维护者或提交 Issue。

---

## 七、版本历史

- **v1.2** (2025): 添加 AI 桥接层、8 位扩展元件、文字标注功能
- **v1.0** (2013-2016): 初始版本

---

## 八、贡献者

- 原作者: 张雯雰老师（湘南学院）
- 扩展开发: [您的名字]

---

## 九、许可证

本程序遵循 GNU General Public License v3.0 开源协议。

---

**更新日期**: 2025年
**文档版本**: 1.0
